const a5_0x4a0a=['retryDuring','We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','createNoNewMessagesTimeout','wait','./node_modules/.cache/nx','Executing:\x20\x27','true','then','tasks','next','exit','length','CIRCLE_STAGE','output','maxParallel','forEach','VERBOSE_LOGGING','.lock','params','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','getRunGroup','criticalErrorMessage','configuration','projects','throw','Agent\x20','readdirSync','target','parse','note','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','assign','join','cacheDirectory','Other\x20Nx\x20Cloud\x20Agents\x20Detected','message','projectName','child_process','executionId','readFileSync','maxParallel:\x20','error','../../../utilities/environment','value','completed:\x20','\x20--projects=','\x20--parallel\x20--max-parallel=','status','defineProperty','startAgent','random','inherit','writeFileSync','existsSync','SIGINT','warn','tasksRunnerOptions','catch','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','rmSync','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','completed','Distributed\x20Execution\x20Terminated','Duplicate\x20Agent\x20ID\x20Detected','strip-json-comments','retryDuring:\x20','executionId:\x20','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','Critical\x20Error\x20in\x20Agent:\x20\x22','@nrwl/workspace/src/utilities/output','reset','number\x20of\x20tasks:\x20','getTime','../../../utilities/waiter','env','--configuration=','completedTasks','includes','Waiting...','Fetching\x20tasks...','CIRCLECI','DistributedAgentApi','mkdirSync','completedStatusCode','push','done'];(function(_0x4bd6cd,_0x4a0a2d){const _0x5b5792=function(_0x51e6d0){while(--_0x51e6d0){_0x4bd6cd['push'](_0x4bd6cd['shift']());}};_0x5b5792(++_0x4a0a2d);}(a5_0x4a0a,0x1a2));const a5_0x5b57=function(_0x4bd6cd,_0x4a0a2d){_0x4bd6cd=_0x4bd6cd-0x0;let _0x5b5792=a5_0x4a0a[_0x4bd6cd];return _0x5b5792;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x376c94,_0x17ac20,_0x4bb347,_0x38ca4f){function _0x54d3f4(_0x49ecff){return _0x49ecff instanceof _0x4bb347?_0x49ecff:new _0x4bb347(function(_0x16b11c){_0x16b11c(_0x49ecff);});}return new(_0x4bb347||(_0x4bb347=Promise))(function(_0x1b199f,_0x1f7c4d){function _0x2f0a32(_0xf4bc4a){try{_0xb3dd04(_0x38ca4f[a5_0x5b57('0x15')](_0xf4bc4a));}catch(_0x4d00e8){_0x1f7c4d(_0x4d00e8);}}function _0x4eb31f(_0x266097){try{_0xb3dd04(_0x38ca4f[a5_0x5b57('0x24')](_0x266097));}catch(_0x2fb5a6){_0x1f7c4d(_0x2fb5a6);}}function _0xb3dd04(_0x2872ba){_0x2872ba[a5_0x5b57('0xb')]?_0x1b199f(_0x2872ba[a5_0x5b57('0x37')]):_0x54d3f4(_0x2872ba[a5_0x5b57('0x37')])[a5_0x5b57('0x13')](_0x2f0a32,_0x4eb31f);}_0xb3dd04((_0x38ca4f=_0x38ca4f['apply'](_0x376c94,_0x17ac20||[]))[a5_0x5b57('0x15')]());});};Object[a5_0x5b57('0x3c')](exports,'__esModule',{'value':!![]});exports[a5_0x5b57('0x3d')]=void 0x0;const output_1=require(a5_0x5b57('0x51'));const child_process_1=require(a5_0x5b57('0x31'));const stripJsonComments=require(a5_0x5b57('0x4c'));const distributed_agent_api_1=require('./distributed-agent.api');const waiter_1=require(a5_0x5b57('0x55'));const environment_1=require(a5_0x5b57('0x36'));const print_run_group_error_1=require('../../error/print-run-group-error');const create_no_new_messages_timeout_1=require('../../../utilities/create-no-new-messages-timeout');const fs_1=require('fs');function executeTasks(_0x23152f,_0xf88395){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x4b1c33=0x0;let _0xa9f019=null;const _0x7f8dd5=create_no_new_messages_timeout_1[a5_0x5b57('0xe')]();const _0x217166=new waiter_1['Waiter']();let _0x327442=[];const _0x9a8624=new Date();let _0x49092c=![];while(!![]){if(environment_1[a5_0x5b57('0x1c')]){output_1['output'][a5_0x5b57('0x29')]({'title':a5_0x5b57('0x5')});}_0xa9f019=yield _0xf88395[a5_0x5b57('0x14')](_0xa9f019?_0xa9f019[a5_0x5b57('0x32')]:null,_0x4b1c33,_0x327442);if(environment_1[a5_0x5b57('0x1c')]){output_1['output']['note']({'title':'API\x20Response','bodyLines':[a5_0x5b57('0x38')+_0xa9f019[a5_0x5b57('0x49')],a5_0x5b57('0x4d')+_0xa9f019[a5_0x5b57('0xc')],a5_0x5b57('0x4e')+_0xa9f019[a5_0x5b57('0x32')],a5_0x5b57('0x53')+_0xa9f019[a5_0x5b57('0x14')][a5_0x5b57('0x17')],'error:\x20'+_0xa9f019[a5_0x5b57('0x21')],a5_0x5b57('0x34')+_0xa9f019[a5_0x5b57('0x1a')]]});}if(_0xa9f019['criticalErrorMessage']){output_1[a5_0x5b57('0x19')][a5_0x5b57('0x35')]({'title':a5_0x5b57('0x4a'),'bodyLines':['Error:',_0xa9f019[a5_0x5b57('0x21')]]});process[a5_0x5b57('0x16')](0x0);}if((_0xa9f019===null||_0xa9f019===void 0x0?void 0x0:_0xa9f019['retryDuring'])&&(_0xa9f019===null||_0xa9f019===void 0x0?void 0x0:_0xa9f019[a5_0x5b57('0xc')])!==0x0&&!_0x49092c&&new Date()[a5_0x5b57('0x54')]()-_0x9a8624[a5_0x5b57('0x54')]()>_0xa9f019['retryDuring']){yield _0x217166['wait']();continue;}if(_0xa9f019[a5_0x5b57('0x49')])return;_0x7f8dd5(_0xa9f019[a5_0x5b57('0x14')]['map'](_0x3df975=>_0x3df975['taskId'])[a5_0x5b57('0x2c')](''));if(!_0xa9f019[a5_0x5b57('0x32')]){if(environment_1['VERBOSE_LOGGING']){output_1[a5_0x5b57('0x19')]['note']({'title':a5_0x5b57('0x4')});}yield _0x217166[a5_0x5b57('0xf')]();_0x4b1c33=0x0;_0x327442=[];continue;}_0x217166[a5_0x5b57('0x52')]();_0x49092c=!![];const _0x1b5aef=invokeTasksUsingRunMany(_0x23152f,_0xa9f019[a5_0x5b57('0x32')],_0xa9f019[a5_0x5b57('0x14')],_0xa9f019['maxParallel']);_0x4b1c33=_0x1b5aef[a5_0x5b57('0x9')];_0x327442=_0x1b5aef[a5_0x5b57('0x2')];}});}function readCompletedTasks(_0x4a4088){const _0x57eb0a=_0x4a4088[a5_0x5b57('0x2d')]||a5_0x5b57('0x10');return JSON[a5_0x5b57('0x28')](fs_1[a5_0x5b57('0x33')](_0x57eb0a+'/tasks-hashes')['toString']());}function invokeTasksUsingRunMany(_0x41162,_0x2c5048,_0x16e680,_0x1c253b){let _0x20ed1a=0x0;const _0x3d9fe3=[];for(const _0x1ca7ab of groupByTarget(_0x16e680)){const _0x3a4c68=_0x1ca7ab['configuration']?a5_0x5b57('0x1')+_0x1ca7ab[a5_0x5b57('0x22')]:'';const _0x1625ee=_0x1c253b>0x1?a5_0x5b57('0x3a')+_0x1c253b:'';const _0x54510c='npx\x20nx\x20run-many\x20--target='+_0x1ca7ab[a5_0x5b57('0x27')]+'\x20'+_0x3a4c68+a5_0x5b57('0x39')+_0x1ca7ab[a5_0x5b57('0x23')]['join'](',')+'\x20'+_0x1ca7ab['params']+_0x1625ee;if(environment_1['VERBOSE_LOGGING']){output_1[a5_0x5b57('0x19')]['note']({'title':a5_0x5b57('0x11')+_0x54510c+'\x27'});}try{child_process_1['execSync'](_0x54510c,{'stdio':[a5_0x5b57('0x3f'),a5_0x5b57('0x3f'),a5_0x5b57('0x3f')],'env':Object[a5_0x5b57('0x2b')](Object[a5_0x5b57('0x2b')]({},process[a5_0x5b57('0x0')]),{'NX_CACHE_FAILURES':a5_0x5b57('0x12'),'NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x2c5048})});}catch(_0x2c83ee){if(_0x2c83ee[a5_0x5b57('0x3b')]===environment_1[a5_0x5b57('0x46')]){throw _0x2c83ee;}else{_0x20ed1a=0x1;}}finally{_0x3d9fe3[a5_0x5b57('0xa')](...readCompletedTasks(_0x41162));}}return{'completedStatusCode':_0x20ed1a,'completedTasks':_0x3d9fe3};}function groupByTarget(_0x408374){const _0x598849=[];_0x408374[a5_0x5b57('0x1b')](_0x2af58c=>{const _0x1fe759=_0x598849['find'](_0x4bb18a=>_0x4bb18a[a5_0x5b57('0x27')]===_0x2af58c[a5_0x5b57('0x27')]&&_0x4bb18a[a5_0x5b57('0x22')]===_0x2af58c[a5_0x5b57('0x22')]);if(_0x1fe759){_0x1fe759[a5_0x5b57('0x23')][a5_0x5b57('0xa')](_0x2af58c['projectName']);}else{_0x598849['push']({'target':_0x2af58c['target'],'projects':[_0x2af58c[a5_0x5b57('0x30')]],'params':_0x2af58c[a5_0x5b57('0x1e')],'configuration':_0x2af58c[a5_0x5b57('0x22')]});}});return _0x598849;}function getAgentName(){if(process[a5_0x5b57('0x0')]['NX_AGENT_NAME']!==undefined){return process[a5_0x5b57('0x0')]['NX_AGENT_NAME'];}else if(process[a5_0x5b57('0x0')][a5_0x5b57('0x6')]!==undefined){return process[a5_0x5b57('0x0')][a5_0x5b57('0x18')];}else{return a5_0x5b57('0x25')+Math['floor'](Math[a5_0x5b57('0x3e')]()*0x186a0);}}function createAgentLockfile(_0x250ff2,_0x5770ec){const _0x4bae6f=_0x250ff2['cacheDirectory']||a5_0x5b57('0x10');const _0x408c28=_0x4bae6f+'/lockfiles';const _0x2491a6=_0x408c28+'/'+_0x5770ec+a5_0x5b57('0x1d');if(!fs_1[a5_0x5b57('0x41')](''+_0x408c28)){fs_1[a5_0x5b57('0x8')](''+_0x408c28,{'recursive':!![]});}const _0x5324f8=fs_1[a5_0x5b57('0x26')](''+_0x408c28);if(_0x5324f8[a5_0x5b57('0x17')]){if(_0x5324f8[a5_0x5b57('0x3')](_0x5770ec+a5_0x5b57('0x1d'))){output_1[a5_0x5b57('0x19')]['error']({'title':a5_0x5b57('0x4b'),'bodyLines':[a5_0x5b57('0xd'),'',a5_0x5b57('0x2a')]});process[a5_0x5b57('0x16')](0x1);}output_1[a5_0x5b57('0x19')][a5_0x5b57('0x43')]({'title':a5_0x5b57('0x2e'),'bodyLines':['We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','',a5_0x5b57('0x4f'),a5_0x5b57('0x48')]});}fs_1[a5_0x5b57('0x40')](''+_0x2491a6,'');process['on'](a5_0x5b57('0x16'),()=>cleanupAgentLockfile(_0x2491a6));process['on'](a5_0x5b57('0x42'),()=>cleanupAgentLockfile(_0x2491a6));}function cleanupAgentLockfile(_0x3bfd47){if(fs_1[a5_0x5b57('0x41')](''+_0x3bfd47)){fs_1[a5_0x5b57('0x47')](''+_0x3bfd47);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x315468=environment_1[a5_0x5b57('0x20')]();if(!_0x315468){print_run_group_error_1['printRunGroupError']();return process[a5_0x5b57('0x16')](0x1);}output_1[a5_0x5b57('0x19')][a5_0x5b57('0x29')]({'title':a5_0x5b57('0x1f')});const _0x17deb9=JSON[a5_0x5b57('0x28')](stripJsonComments(fs_1['readFileSync']('nx.json')['toString']()))[a5_0x5b57('0x44')]['default']['options'];const _0xfe8c4=getAgentName();createAgentLockfile(_0x17deb9,_0xfe8c4);const _0xfe7586=new distributed_agent_api_1[(a5_0x5b57('0x7'))](_0x17deb9,_0x315468,_0xfe8c4);return executeTasks(_0x17deb9,_0xfe7586)[a5_0x5b57('0x45')](_0x21f0a6=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0xfe7586['completeRunGroupWithError'](a5_0x5b57('0x50')+_0x21f0a6[a5_0x5b57('0x2f')]+'\x22');throw _0x21f0a6;}));});}exports[a5_0x5b57('0x3d')]=startAgent;