const a0_0xf34f=['value','../../file-storage/e2e-encryption','TaskRunnerLifeCycle','./cloud-run.api','map','../../terminal-output/message-reporter','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','tasks','waitForStoreRequestsToComplete','hash','note','Completed\x20tasks','OutputObfuscator','Agent\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run','terminalOutput','tasks-hashes','MessageReporter','__awaiter','stringify','...','@nrwl/workspace/src/tasks-runner/tasks-runner-v2','../../terminal-output/output-obfuscator','taskId','VERBOSE_LOGGING','FileStorage','./cloud-remote-cache','CloudRunApi','join','EndOfRunMessage','requests','extractGitSha','cacheDirectory','error','@nrwl/workspace/src/utilities/output','output','getBranch','writeFileSync','./node_modules/.cache/nx','Subject','subscribe','apply','getMachineInfo','complete','ENCRYPTION_KEY','../../../utilities/environment','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','forEach','printMessages','assign','cacheableOperations','path','./task-runner-life-cycle','Agent\x20wasn\x27t\x20able\x20to\x20store\x20artifacts','throw','next','cloudEnabledTasksRunner','NUMBER_OF_TRIES','then','scan','E2EEncryption','CloudRemoteCache','tasksRunnerV2','filter','exit','parseCommand','env','NX_CLOUD_DISTRIBUTED_EXECUTION_ID'];(function(_0x18489c,_0xf34f05){const _0x304728=function(_0x331fb4){while(--_0x331fb4){_0x18489c['push'](_0x18489c['shift']());}};_0x304728(++_0xf34f05);}(a0_0xf34f,0xca));const a0_0x3047=function(_0x18489c,_0xf34f05){_0x18489c=_0x18489c-0x0;let _0x304728=a0_0xf34f[_0x18489c];return _0x304728;};'use strict';var __awaiter=this&&this[a0_0x3047('0x10')]||function(_0x30935b,_0x320f6c,_0x5d1a74,_0x682e06){function _0x12dfbf(_0x1e8ef7){return _0x1e8ef7 instanceof _0x5d1a74?_0x1e8ef7:new _0x5d1a74(function(_0x24f179){_0x24f179(_0x1e8ef7);});}return new(_0x5d1a74||(_0x5d1a74=Promise))(function(_0x4a8c3e,_0x3c20ad){function _0xa2d081(_0x5f3bdf){try{_0x591161(_0x682e06[a0_0x3047('0x35')](_0x5f3bdf));}catch(_0x1d3980){_0x3c20ad(_0x1d3980);}}function _0x4ad8f4(_0x232419){try{_0x591161(_0x682e06[a0_0x3047('0x34')](_0x232419));}catch(_0x585ee7){_0x3c20ad(_0x585ee7);}}function _0x591161(_0x3ef0b8){_0x3ef0b8['done']?_0x4a8c3e(_0x3ef0b8[a0_0x3047('0x42')]):_0x12dfbf(_0x3ef0b8[a0_0x3047('0x42')])[a0_0x3047('0x38')](_0xa2d081,_0x4ad8f4);}_0x591161((_0x682e06=_0x682e06[a0_0x3047('0x27')](_0x30935b,_0x320f6c||[]))[a0_0x3047('0x35')]());});};Object['defineProperty'](exports,'__esModule',{'value':!![]});exports['cloudEnabledTasksRunner']=void 0x0;const Subject_1=require('rxjs/internal/Subject');const message_reporter_1=require(a0_0x3047('0x4'));const end_of_run_message_1=require('../../terminal-output/end-of-run-message');const output_obfuscator_1=require(a0_0x3047('0x14'));const task_runner_life_cycle_1=require(a0_0x3047('0x32'));const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require(a0_0x3047('0x0'));const environment_1=require(a0_0x3047('0x2b'));const cloud_remote_cache_1=require(a0_0x3047('0x18'));const tasks_runner_v2_1=require(a0_0x3047('0x13'));const output_1=require(a0_0x3047('0x20'));const cloud_run_api_1=require(a0_0x3047('0x2'));const fs_1=require('fs');const path=require(a0_0x3047('0x31'));function createApi(_0x50828d,_0x520fbe,_0x46ec37){const _0x5b76ff=environment_1[a0_0x3047('0x28')](_0x520fbe);return new cloud_run_api_1[(a0_0x3047('0x19'))](_0x50828d,_0x46ec37,_0x520fbe,_0x5b76ff);}function storeTaskHashes(_0x5ea45e,_0x120fd8){const _0x1204aa=JSON['stringify'](_0x5ea45e[a0_0x3047('0x3')](_0x324b84=>({'taskId':_0x324b84[a0_0x3047('0x15')],'hash':_0x324b84[a0_0x3047('0x8')]})));if(environment_1[a0_0x3047('0x16')]){output_1[a0_0x3047('0x21')][a0_0x3047('0x9')]({'title':'Executed\x20tasks\x20with\x20hashes:\x20'+_0x1204aa});}fs_1[a0_0x3047('0x23')](path[a0_0x3047('0x1a')](_0x120fd8,a0_0x3047('0xe')),_0x1204aa);}function cloudEnabledTasksRunner(_0x623a21,_0x3ff589,_0x347e4f){const _0x382c92={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x623a21};const _0x58d36b=new message_reporter_1[(a0_0x3047('0xf'))](_0x3ff589);const _0x37aab2=createApi(_0x58d36b,_0x3ff589,_0x382c92);const _0x147b92=new end_of_run_message_1[(a0_0x3047('0x1b'))](_0x58d36b,_0x382c92);const _0x5eb5ae=new output_obfuscator_1[(a0_0x3047('0xb'))]();const _0x21c36f=_0x623a21[a0_0x3047('0x3')](_0x4c96ee=>_0x4c96ee[a0_0x3047('0x8')])[a0_0x3047('0x3d')](_0x3828a7=>!!_0x3828a7);const _0x325213=_0x37aab2['startRun'](environment_1[a0_0x3047('0x41')],_0x21c36f);_0x21c36f[a0_0x3047('0x2d')](_0x2002bf=>{_0x382c92[a0_0x3047('0x1c')][_0x2002bf]=_0x325213;});const _0x219cbd=new Date()['toISOString']();const _0x520823=new task_runner_life_cycle_1[(a0_0x3047('0x1'))](_0x382c92,_0x3ff589[a0_0x3047('0x1e')],_0x3ff589[a0_0x3047('0x39')]===undefined?!![]:_0x3ff589[a0_0x3047('0x39')],_0x3ff589[a0_0x3047('0x30')]||[],_0x5eb5ae);const _0x2b932b=new e2e_encryption_1[(a0_0x3047('0x3a'))](environment_1[a0_0x3047('0x2a')]||_0x3ff589['encryptionKey']);const _0x19279c=new file_storage_1[(a0_0x3047('0x17'))](_0x2b932b,environment_1[a0_0x3047('0x37')]);const _0x11f5e5=new cloud_remote_cache_1[(a0_0x3047('0x3b'))](_0x58d36b,_0x37aab2,_0x382c92,_0x19279c);delete process[a0_0x3047('0x40')][a0_0x3047('0x41')];const _0x120b4b=tasks_runner_v2_1[a0_0x3047('0x3c')](_0x623a21,Object[a0_0x3047('0x2f')](Object['assign']({},_0x3ff589),{'remoteCache':_0x11f5e5,'lifeCycle':_0x520823}),_0x347e4f);const _0x4504c5=new Subject_1[(a0_0x3047('0x25'))]();_0x120b4b[a0_0x3047('0x26')]({'next':_0x45f92f=>_0x4504c5[a0_0x3047('0x35')](_0x45f92f),'error':_0x6a9f6b=>_0x4504c5[a0_0x3047('0x1f')](_0x6a9f6b),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x40217d=new Date()['toISOString']();if(environment_1[a0_0x3047('0x16')]){const _0x3cd06a=_0x520823['tasks'][a0_0x3047('0x3')](_0x303d60=>{return Object[a0_0x3047('0x2f')](Object[a0_0x3047('0x2f')]({},_0x303d60),{'terminalOutput':_0x303d60[a0_0x3047('0xd')]?_0x303d60[a0_0x3047('0xd')]['slice'](0x0,0x14)+a0_0x3047('0x12'):undefined});});output_1['output']['note']({'title':a0_0x3047('0xa'),'bodyLines':['\x0a'+JSON[a0_0x3047('0x11')](_0x3cd06a,null,0x2)]});}if(environment_1[a0_0x3047('0x2c')]){storeTaskHashes(_0x520823[a0_0x3047('0x6')],_0x3ff589['cacheDirectory']||a0_0x3047('0x24'));}const _0x45a401=environment_1[a0_0x3047('0x22')]();const _0x4192bb=yield Promise['all']([_0x11f5e5[a0_0x3047('0x7')](),_0x37aab2['endRun']({'command':_0x5eb5ae['obfuscate'](environment_1[a0_0x3047('0x3f')]()),'startTime':_0x219cbd,'endTime':_0x40217d,'distributedExecutionId':environment_1[a0_0x3047('0x41')],'branch':_0x45a401,'scan':!![],'runGroup':environment_1['getRunGroup'](),'sha':_0x45a401?environment_1[a0_0x3047('0x1d')]():undefined},_0x520823[a0_0x3047('0x6')])]);_0x58d36b[a0_0x3047('0x2e')]();_0x147b92[a0_0x3047('0x6')]=_0x520823[a0_0x3047('0x6')];if(environment_1[a0_0x3047('0x2c')]){if(!_0x4192bb[0x0]){output_1[a0_0x3047('0x21')][a0_0x3047('0x1f')]({'title':a0_0x3047('0x33')});process[a0_0x3047('0x3e')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}if(!_0x4192bb[0x1]){output_1['output'][a0_0x3047('0x1f')]({'title':a0_0x3047('0xc')});process['exit'](environment_1[a0_0x3047('0x5')]);}}_0x4504c5[a0_0x3047('0x29')]();})});return _0x4504c5;}exports[a0_0x3047('0x36')]=cloudEnabledTasksRunner;